<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trivia Bot | The Protocol</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Orbitron:wght@600;700;900&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        :root {
            /* SYNTHWAVE PALETTE */
            --bg-deep: #0b001a;
            --neon-pink: #ff00ff;
            --neon-cyan: #00ffff;
            --sun-yellow: #ffbd00;
            --sun-orange: #ff5500;
            --grid-color: rgba(255, 0, 255, 0.3);
            
            --glass-bg: rgba(20, 10, 40, 0.75);
            --glass-border: rgba(255, 100, 255, 0.15);
            --text-main: #f0f0f0;
            --text-muted: #b0a0c0;
            
            --glow-pink: 0 0 15px rgba(255, 0, 255, 0.4);
            --glow-cyan: 0 0 15px rgba(0, 255, 255, 0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--text-main);
            background-color: var(--bg-deep);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- CRT SCANLINE OVERLAY --- */
        body::after {
            content: "";
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 3px, 3px 100%;
            pointer-events: none;
            z-index: 9999;
        }

        /* --- 3D CANVAS --- */
        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }

        /* --- STARTUP --- */
        #startup-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            transition: opacity 1s ease; cursor: pointer; padding: 20px; text-align: center;
        }
        #startup-overlay h1 {
            font-family: 'Orbitron'; font-size: clamp(2rem, 6vw, 4rem);
            background: linear-gradient(to bottom, var(--sun-yellow), var(--sun-orange));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px var(--sun-orange);
            margin-bottom: 20px; letter-spacing: 2px;
        }
        #startup-overlay p { color: var(--neon-cyan); font-family: 'JetBrains Mono'; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        /* --- NAVIGATION --- */
        nav {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            z-index: 1000; display: flex; gap: 8px;
            background: rgba(10, 0, 20, 0.8);
            padding: 8px 12px; border-radius: 4px;
            border: 1px solid var(--neon-pink);
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.2);
            backdrop-filter: blur(10px); width: max-content; max-width: 95%;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }
        .nav-btn {
            background: transparent; border: none; color: var(--text-muted);
            padding: 8px 16px; font-weight: 600; font-size: 0.85rem; cursor: pointer;
            transition: all 0.2s; font-family: 'Orbitron', sans-serif; letter-spacing: 1px;
            text-transform: uppercase;
        }
        .nav-btn:hover { color: #fff; text-shadow: 0 0 8px #fff; }
        .nav-btn.active { color: var(--neon-cyan); text-shadow: var(--glow-cyan); border-bottom: 2px solid var(--neon-cyan); }
        
        .sound-toggle { margin-left: 10px; border-left: 1px solid var(--glass-border); padding-left: 15px; display: flex; align-items: center; }
        .sound-toggle svg { width: 18px; height: 18px; fill: var(--text-muted); transition: fill 0.3s; }
        .sound-toggle.active svg { fill: var(--neon-pink); filter: drop-shadow(0 0 5px var(--neon-pink)); }

        /* --- SECTIONS --- */
        .page-section { display: none; min-height: 100vh; padding: 140px 20px 80px; opacity: 0; transform: translateY(20px); transition: opacity 0.6s ease, transform 0.6s ease; }
        .page-section.active { display: block; opacity: 1; transform: translateY(0); }

        /* --- HERO --- */
        #home { display: none; flex-direction: column; justify-content: center; align-items: center; text-align: center; height: 100vh; padding-top: 0; }
        #home.active { display: flex; }
        
        .hero-title {
            font-family: 'Orbitron'; font-size: clamp(3rem, 10vw, 6rem); font-weight: 900; line-height: 0.9;
            background: linear-gradient(180deg, #fff 0%, var(--neon-pink) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 40px rgba(255, 0, 255, 0.4);
            margin-bottom: 20px; letter-spacing: -2px; transform: skewX(-5deg);
        }
        
        .hero-subtitle {
            font-size: clamp(0.9rem, 3vw, 1.2rem); color: var(--neon-cyan);
            text-transform: uppercase; letter-spacing: 6px; margin-bottom: 50px;
            text-shadow: var(--glow-cyan); font-weight: 700;
        }
        
        .cta-group { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        
        .btn-retro {
            position: relative; padding: 16px 40px; font-family: 'Orbitron'; font-weight: 700;
            text-transform: uppercase; color: #fff; background: transparent;
            border: 2px solid var(--neon-pink); cursor: pointer; overflow: hidden;
            transition: 0.2s; text-decoration: none; display: flex; align-items: center; gap: 10px;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.2), inset 0 0 10px rgba(255, 0, 255, 0.1);
        }
        .btn-retro::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: 0.5s;
        }
        .btn-retro:hover { box-shadow: 0 0 20px var(--neon-pink), inset 0 0 20px var(--neon-pink); text-shadow: 0 0 5px #fff; transform: translateY(-2px); }
        .btn-retro:hover::before { left: 100%; }
        
        .btn-retro.secondary { border-color: var(--neon-cyan); color: var(--neon-cyan); box-shadow: 0 0 10px rgba(0, 255, 255, 0.2); }
        .btn-retro.secondary:hover { box-shadow: 0 0 20px var(--neon-cyan); color: #fff; }

        /* --- CARDS (Wiki/Legal) --- */
        .docs-container { max-width: 1200px; margin: 0 auto; }
        .docs-header h1 { text-align: center; font-family: 'Orbitron'; font-size: 2.5rem; margin-bottom: 40px; color: #fff; text-shadow: var(--glow-pink); }
        
        .search-bar {
            width: 100%; max-width: 600px; margin: 0 auto 50px; display: block;
            padding: 15px; background: rgba(0,0,0,0.5); border: 1px solid var(--neon-cyan);
            color: #fff; font-family: 'JetBrains Mono'; box-shadow: 0 0 10px rgba(0, 255, 255, 0.1);
            transition: 0.3s;
        }
        .search-bar:focus { outline: none; box-shadow: 0 0 20px var(--neon-cyan); }

        .guide-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; }
        
        .guide-card {
            background: linear-gradient(135deg, rgba(20, 10, 40, 0.9) 0%, rgba(10, 5, 20, 0.95) 100%);
            border: 1px solid var(--glass-border); position: relative; padding: 25px;
            transition: 0.3s; overflow: hidden;
        }
        .guide-card::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 2px; background: var(--neon-cyan); transform: scaleX(0); transition: 0.3s; transform-origin: left; }
        .guide-card:hover { transform: translateY(-5px); border-color: var(--neon-cyan); box-shadow: 0 5px 30px rgba(0,0,0,0.5); }
        .guide-card:hover::after { transform: scaleX(1); }
        
        .guide-card.risk { border-color: rgba(255, 0, 100, 0.3); }
        .guide-card.risk:hover { border-color: #ff0066; }
        .guide-card.risk:hover::after { background: #ff0066; }

        .card-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .guide-icon { font-size: 1.8rem; text-shadow: 0 0 10px rgba(255,255,255,0.3); }
        .guide-title h3 { font-family: 'Orbitron'; font-size: 1.2rem; color: #fff; }
        .guide-title p { color: var(--text-muted); font-size: 0.85rem; font-family: 'JetBrains Mono'; }
        
        .expand-btn {
            background: rgba(255,255,255,0.05); border: none; color: var(--neon-cyan);
            width: 100%; padding: 10px; font-family: 'JetBrains Mono'; text-transform: uppercase;
            cursor: pointer; transition: 0.2s; margin-top: auto; font-size: 0.8rem;
        }
        .expand-btn:hover { background: rgba(0, 255, 255, 0.1); letter-spacing: 1px; }

        .details-panel { max-height: 0; overflow: hidden; transition: all 0.5s ease; opacity: 0; }
        .guide-card.expanded .details-panel { max-height: 800px; opacity: 1; margin-top: 20px; padding-top: 15px; border-top: 1px dashed var(--glass-border); }
        
        .code-snippet { background: #1a1120; color: var(--neon-pink); padding: 5px 8px; font-family: 'JetBrains Mono'; font-size: 0.8rem; border: 1px solid rgba(255,0,255,0.2); display: inline-block; margin-bottom: 5px; }
        
        .legal-wrapper { max-width: 800px; margin: 0 auto; background: var(--glass-bg); padding: 40px; border: 1px solid var(--glass-border); }
        .legal-wrapper h2 { font-family: 'Orbitron'; color: #fff; border-bottom: 2px solid var(--neon-pink); padding-bottom: 10px; margin-bottom: 30px; }
        .legal-block h3 { color: var(--neon-cyan); font-family: 'Orbitron'; margin: 25px 0 10px; }
        .legal-block p, li { color: var(--text-muted); line-height: 1.6; margin-bottom: 10px; }

        footer { text-align: center; padding: 40px; color: rgba(255,255,255,0.3); font-size: 0.8rem; font-family: 'JetBrains Mono'; border-top: 1px solid rgba(255,255,255,0.05); background: #000; position: relative; z-index: 10; }

        @media (max-width: 768px) {
            .hero-title { font-size: 13vw; }
            .guide-grid { grid-template-columns: 1fr; }
            .cta-group { flex-direction: column; width: 100%; }
            .btn-retro { width: 100%; justify-content: center; }
            nav { width: 95%; justify-content: space-between; }
        }
    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <div id="startup-overlay" onclick="initializeSystem()">
        <h1>SYSTEM READY</h1>
        <p>[ CLICK TO INITIALIZE ]</p>
    </div>

    <nav>
        <button id="nav-home" class="nav-btn active" onclick="handleNavClick('home')">Home</button>
        <button id="nav-guide" class="nav-btn" onclick="handleNavClick('guide')">Database</button>
        <button id="nav-legal" class="nav-btn" onclick="handleNavClick('legal')">Legal</button>
        <div id="sound-btn" class="sound-toggle" onclick="toggleSound()">
            <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
        </div>
    </nav>

    <section id="home" class="page-section active">
        <h1 class="hero-title">TRIVIA<br>PROTOCOL</h1>
        <div class="hero-subtitle">The Grid Awaits</div>
        
        <div class="cta-group">
            <a href="https://discord.gg/ZjJMn8KeZs" target="_blank" class="btn-retro">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.419-2.1568 2.419zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.419-2.1568 2.419z"/></svg>
                Support Server
            </a>
            <button onclick="handleNavClick('guide')" class="btn-retro secondary">Access Database</button>
        </div>
    </section>

    <section id="guide" class="page-section">
        <div class="docs-container">
            <div class="docs-header">
                <h1>DATA ARCHIVE</h1>
            </div>
            <input type="text" id="guideSearch" class="search-bar" placeholder="SEARCH QUERY..." onkeyup="filterGuide()">

            <div class="guide-grid">
                <div class="guide-card" data-keywords="trivia core start loop">
                    <div class="card-header">
                        <span class="guide-icon">üß†</span>
                        <div class="guide-title">
                            <h3>Core Protocol</h3>
                            <p>Automated Logic</p>
                        </div>
                    </div>
                    <button class="expand-btn" onclick="toggleDetails(this)">‚ñº Access Data</button>
                    <div class="details-panel">
                        <div class="code-snippet">/start [channel]</div>
                        <ul style="list-style:none; color:var(--text-muted); font-size:0.9rem;">
                            <li>‚Ä¢ Timer: 20 Minutes</li>
                            <li>‚Ä¢ Points: 100/250/500</li>
                            <li>‚Ä¢ Global CD: 15 Minutes</li>
                        </ul>
                    </div>
                </div>

                <div class="guide-card" data-keywords="economy shop items auction">
                    <div class="card-header">
                        <span class="guide-icon">üí≥</span>
                        <div class="guide-title">
                            <h3>Economy</h3>
                            <p>Credits & Trade</p>
                        </div>
                    </div>
                    <button class="expand-btn" onclick="toggleDetails(this)">‚ñº Access Data</button>
                    <div class="details-panel">
                        <div class="code-snippet">/shop</div>
                        <p style="color:#aaa; font-size:0.9rem;">Shield (200), Hint (150), Backup (500)</p>
                    </div>
                </div>

                <div class="guide-card risk" data-keywords="duel pvp risky">
                    <div class="card-header">
                        <span class="guide-icon">‚öîÔ∏è</span>
                        <div class="guide-title">
                            <h3>Duel Protocol</h3>
                            <p>Risky Mode</p>
                        </div>
                    </div>
                    <button class="expand-btn" onclick="toggleDetails(this)">‚ñº Access Data</button>
                    <div class="details-panel">
                        <div class="code-snippet">/duel [user] Risky</div>
                        <p style="color:#aaa; font-size:0.9rem;">Fee: 50 CR. Cooldown: 20h. Theft: 30% of loser's wallet on 5-0 win.</p>
                    </div>
                </div>

                <div class="guide-card" data-keywords="raid boss">
                    <div class="card-header">
                        <span class="guide-icon">üëπ</span>
                        <div class="guide-title">
                            <h3>Boss Raids</h3>
                            <p>Co-op Events</p>
                        </div>
                    </div>
                    <button class="expand-btn" onclick="toggleDetails(this)">‚ñº Access Data</button>
                    <div class="details-panel">
                        <div class="code-snippet">/raid_start</div>
                        <p style="color:#aaa; font-size:0.9rem;">DMG: 500 per hit. Loot based on DMG dealt. Killer bonus: 3000 CR.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="legal" class="page-section">
        <div class="legal-wrapper">
            <div id="tos" class="legal-block">
                <h2>Terms of Service</h2>
                <p><strong>Effective Date:</strong> December 2025</p>
                <h3>1. Agreement to Terms</h3>
                <p>By interacting with Trivia Bot ("the Service"), you agree to these Terms.</p>
                <h3>2. Usage & Conduct</h3>
                <ul>
                    <li><strong>Fair Play:</strong> No self-bots, macros, or alts.</li>
                    <li><strong>No Exploits:</strong> Abuse of bugs results in bans.</li>
                </ul>
                <h3>3. Virtual Assets</h3>
                <p>Credits have <strong>no real-world value</strong>. Real Money Trading (RMT) is strictly prohibited.</p>
            </div>
            
            <div id="privacy" class="legal-block" style="margin-top:50px;">
                <h2 style="border-color: var(--neon-cyan);">Privacy Policy</h2>
                <h3>1. Data Collection</h3>
                <p>We store User IDs (Inventory), Guild IDs (Config), and Game Stats.</p>
                <h3>2. Data Retention</h3>
                <p>Data is stored in MongoDB Atlas. Seasonal resets may wipe economy data.</p>
            </div>
        </div>
    </section>

    <footer>
        <p>&copy; 2025 TRIVIA PROTOCOL. SYSTEM BY <span style="color:var(--neon-pink)">LLMA</span>.</p>
    </footer>

    <script>
        // --- 1. SYNTHWAVE AUDIO ENGINE ---
        class AudioEngine {
            constructor() {
                this.ctx = null;
                this.masterGain = null;
                this.filter = null;
            }
            
            init() {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
                this.masterGain = this.ctx.createGain();
                this.masterGain.connect(this.ctx.destination);
                this.masterGain.gain.value = 0;

                // Create Filter (The "Wah" effect)
                this.filter = this.ctx.createBiquadFilter();
                this.filter.type = "lowpass";
                this.filter.frequency.value = 400;
                this.filter.Q.value = 5;
                this.filter.connect(this.masterGain);

                // Create Oscillator Drones (Sawtooth for retro feel)
                const freqs = [55, 55.5, 110, 164.8]; // A1, A1(detuned), A2, E3
                freqs.forEach(f => this.createOsc(f));

                // LFO to modulate filter (Breathing effect)
                const lfo = this.ctx.createOscillator();
                lfo.type = "sine";
                lfo.frequency.value = 0.1; // Slow pulse
                const lfoGain = this.ctx.createGain();
                lfoGain.gain.value = 300; // Filter sweep range
                lfo.connect(lfoGain);
                lfoGain.connect(this.filter.frequency);
                lfo.start();
            }

            createOsc(f) {
                const osc = this.ctx.createOscillator();
                osc.type = "sawtooth";
                osc.frequency.value = f;
                const gain = this.ctx.createGain();
                gain.gain.value = 0.08; // Keep volume low
                osc.connect(gain);
                gain.connect(this.filter);
                osc.start();
            }

            fadeIn() { if(this.ctx) this.masterGain.gain.setTargetAtTime(0.3, this.ctx.currentTime, 2); }
            fadeOut() { if(this.ctx) this.masterGain.gain.setTargetAtTime(0, this.ctx.currentTime, 0.5); }
        }

        const audio = new AudioEngine();
        let soundOn = false;

        function initializeSystem() {
            document.getElementById('startup-overlay').style.opacity = '0';
            setTimeout(() => document.getElementById('startup-overlay').remove(), 1000);
            toggleSound();
        }

        function toggleSound() {
            const btn = document.getElementById('sound-btn');
            if(!soundOn) {
                if(!audio.ctx) audio.init();
                audio.ctx.resume().then(() => {
                    audio.fadeIn();
                    soundOn = true;
                    btn.classList.add('active');
                });
            } else {
                audio.fadeOut();
                soundOn = false;
                btn.classList.remove('active');
            }
        }

        // --- 2. THREE.JS SYNTHWAVE SCENE ---
        const init3D = () => {
            const container = document.getElementById('canvas-container');
            const scene = new THREE.Scene();
            // Fog for the "fade into distance" look
            scene.fog = new THREE.FogExp2(0x0b001a, 0.0025); 

            const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
            camera.position.set(0, 50, 400); // Position camera above grid

            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            // --- A. THE RETRO SUN ---
            // Create a canvas texture for the stripes
            const canvas = document.createElement('canvas');
            canvas.width = 128; canvas.height = 128;
            const ctx = canvas.getContext('2d');
            const grad = ctx.createLinearGradient(0, 0, 0, 128);
            grad.addColorStop(0, '#ffbd00'); // Yellow
            grad.addColorStop(1, '#ff5500'); // Orange
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, 128, 128);
            // Stripes
            ctx.fillStyle = '#0b001a'; // Background color
            for(let y=64; y<128; y+=8) ctx.fillRect(0, y, 128, 2 + (y-64)/8); // Thicker stripes at bottom
            
            const sunTex = new THREE.CanvasTexture(canvas);
            const sunGeo = new THREE.CircleGeometry(300, 64);
            const sunMat = new THREE.MeshBasicMaterial({ map: sunTex, transparent: true, fog: false });
            const sun = new THREE.Mesh(sunGeo, sunMat);
            sun.position.z = -800;
            sun.position.y = 150;
            scene.add(sun);

            // --- B. THE INFINITE GRID (ROAD) ---
            const gridGeo = new THREE.PlaneGeometry(2000, 2000, 40, 40);
            // Displace vertices to make "mountains" on sides
            const pos = gridGeo.attributes.position;
            for(let i=0; i < pos.count; i++){
                const x = pos.getX(i);
                // If x is far left or far right, raise z (which is y in scene)
                if(Math.abs(x) > 200) {
                    pos.setZ(i, Math.random() * 150 * (Math.abs(x)/1000));
                }
            }
            gridGeo.computeVertexNormals();

            const gridMat = new THREE.MeshBasicMaterial({ 
                color: 0xff00ff, 
                wireframe: true,
                transparent: true,
                opacity: 0.3
            });
            const terrain = new THREE.Mesh(gridGeo, gridMat);
            terrain.rotation.x = -Math.PI / 2;
            terrain.position.y = -50;
            scene.add(terrain);

            // Duplicate terrain for infinite loop illusion
            const terrain2 = terrain.clone();
            terrain2.position.z = -2000;
            scene.add(terrain2);

            // --- C. STARFIELD ---
            const starGeo = new THREE.BufferGeometry();
            const starCnt = 1000;
            const starPos = new Float32Array(starCnt * 3);
            for(let i=0; i<starCnt*3; i++) starPos[i] = (Math.random()-0.5) * 2000;
            starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
            const starMat = new THREE.PointsMaterial({color: 0xffffff, size: 2});
            const stars = new THREE.Points(starGeo, starMat);
            scene.add(stars);

            // --- ANIMATION LOOP ---
            const animate = () => {
                requestAnimationFrame(animate);

                // Move Grid
                terrain.position.z += 2;
                terrain2.position.z += 2;
                // Loop
                if(terrain.position.z > 1000) terrain.position.z = -3000;
                if(terrain2.position.z > 1000) terrain2.position.z = -3000;

                // Move Stars (Parallax)
                stars.rotation.z += 0.0005;

                renderer.render(scene, camera);
            };
            animate();

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        };

        // --- 3. UI LOGIC ---
        function handleNavClick(targetId) {
            document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(targetId).classList.add('active');
            document.getElementById('nav-'+targetId).classList.add('active');
            window.scrollTo(0,0);
        }

        function toggleDetails(btn) {
            const card = btn.parentElement;
            const was = card.classList.contains('expanded');
            document.querySelectorAll('.guide-card').forEach(c => {
                c.classList.remove('expanded');
                c.querySelector('.expand-btn').innerText = '‚ñº Access Data';
            });
            if(!was) {
                card.classList.add('expanded');
                btn.innerText = '‚ñ≤ Close Data';
            }
        }

        function filterGuide() {
            const val = document.getElementById('guideSearch').value.toLowerCase();
            document.querySelectorAll('.guide-card').forEach(c => {
                c.style.display = (c.innerText.toLowerCase().includes(val) || c.dataset.keywords.includes(val)) ? 'block' : 'none';
            });
        }

        window.addEventListener('load', () => {
            init3D();
            const hash = window.location.hash.substring(1);
            if(hash) {
                document.getElementById('startup-overlay').remove();
                if(hash === 'tos' || hash === 'privacy') handleNavClick('legal');
                else handleNavClick(hash === 'guide' ? 'guide' : 'home');
            }
        });
    </script>
</body>
</html>
