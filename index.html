<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trivia Bot | The Protocol</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Orbitron:wght@600;700;900&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simplex-noise/2.4.0/simplex-noise.min.js"></script>

    <style>
        :root {
            --bg-deep: #050011;
            --neon-pink: #ff0055;
            --neon-purple: #bd00ff;
            --neon-cyan: #00f3ff;
            --sun-yellow: #ffd700;
            --sun-orange: #ff4800;
            
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #ffffff;
            --text-muted: #a0a0c0;
            
            --glow-pink: 0 0 20px rgba(255, 0, 85, 0.5);
            --glow-cyan: 0 0 20px rgba(0, 243, 255, 0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--text-main);
            background-color: var(--bg-deep);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- VINTAGE OVERLAY --- */
        body::after {
            content: " ";
            display: block;
            position: fixed; top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            z-index: 9999;
            pointer-events: none;
        }

        /* --- 3D CANVAS --- */
        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }

        /* --- STARTUP SCREEN --- */
        #startup-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            transition: opacity 1s ease; cursor: pointer; padding: 20px; text-align: center;
        }
        #startup-overlay h1 {
            font-family: 'Orbitron'; font-size: clamp(2rem, 6vw, 4rem);
            background: linear-gradient(to bottom, var(--sun-yellow), var(--sun-orange));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 40px var(--sun-orange);
            margin-bottom: 20px; letter-spacing: 4px;
        }
        #startup-overlay p { color: var(--neon-cyan); font-family: 'JetBrains Mono'; animation: pulse 1.5s infinite; letter-spacing: 2px; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        /* --- NAVIGATION (Glassium) --- */
        nav {
            position: fixed; top: 30px; left: 50%; transform: translateX(-50%);
            z-index: 1000; display: flex; gap: 15px;
            background: rgba(20, 20, 40, 0.4);
            padding: 10px 15px; border-radius: 50px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: max-content; max-width: 90%;
        }
        
        .nav-btn {
            background: transparent; border: none; color: rgba(255,255,255,0.6);
            padding: 10px 20px; font-weight: 600; font-size: 0.85rem; cursor: pointer;
            transition: all 0.3s ease; font-family: 'Orbitron', sans-serif; letter-spacing: 1px;
            border-radius: 30px; text-transform: uppercase;
        }
        .nav-btn:hover { color: #fff; background: rgba(255,255,255,0.05); }
        .nav-btn.active { 
            color: var(--bg-deep); 
            background: var(--neon-cyan); 
            box-shadow: 0 0 15px var(--neon-cyan);
            font-weight: 800;
        }

        .sound-toggle {
            display: flex; align-items: center; justify-content: center;
            width: 40px; height: 40px; border-radius: 50%;
            background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
            cursor: pointer; transition: 0.3s;
        }
        .sound-toggle svg { width: 18px; fill: #fff; opacity: 0.5; }
        .sound-toggle.active { border-color: var(--neon-pink); box-shadow: 0 0 10px var(--neon-pink); }
        .sound-toggle.active svg { fill: var(--neon-pink); opacity: 1; }

        /* --- SECTIONS --- */
        .page-section { display: none; min-height: 100vh; padding: 140px 20px 80px; opacity: 0; transform: translateY(20px); transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1); }
        .page-section.active { display: block; opacity: 1; transform: translateY(0); }

        /* --- HERO --- */
        #home { display: none; flex-direction: column; justify-content: center; align-items: center; text-align: center; height: 100vh; padding-top: 0; }
        #home.active { display: flex; }
        
        .hero-title {
            font-family: 'Orbitron'; font-size: clamp(3rem, 12vw, 7rem); font-weight: 900; line-height: 1;
            color: #fff; text-shadow: 0 0 40px rgba(255, 0, 85, 0.6);
            margin-bottom: 20px; letter-spacing: -2px; mix-blend-mode: screen;
            transform: skewX(-5deg);
        }
        
        .hero-subtitle {
            font-size: clamp(0.9rem, 3vw, 1.2rem); color: var(--neon-cyan);
            text-transform: uppercase; letter-spacing: 6px; margin-bottom: 50px;
            text-shadow: 0 0 20px var(--neon-cyan); font-weight: 700;
        }
        
        /* Glassium Buttons */
        .cta-group { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        
        .btn-glass {
            position: relative; padding: 18px 45px;
            font-family: 'Orbitron'; font-weight: 700; text-transform: uppercase; letter-spacing: 2px;
            color: #fff; text-decoration: none; cursor: pointer;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .btn-glass::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        
        .btn-glass:hover {
            border-color: var(--neon-pink);
            box-shadow: 0 0 30px rgba(255, 0, 85, 0.4);
            transform: translateY(-3px);
            text-shadow: 0 0 10px rgba(255,255,255,0.8);
        }
        .btn-glass:hover::before { left: 100%; }

        .btn-glass.secondary:hover { border-color: var(--neon-cyan); box-shadow: 0 0 30px rgba(0, 243, 255, 0.4); }

        /* --- CARDS (Wiki/Legal) --- */
        .docs-container { max-width: 1200px; margin: 0 auto; }
        .docs-header h1 { text-align: center; font-family: 'Orbitron'; font-size: 2.5rem; margin-bottom: 40px; color: #fff; text-shadow: 0 0 20px var(--neon-cyan); }
        
        .search-bar {
            width: 100%; max-width: 600px; margin: 0 auto 50px; display: block;
            padding: 18px; background: rgba(0,0,0,0.4); border: 1px solid var(--glass-border);
            border-radius: 12px; color: #fff; font-family: 'JetBrains Mono';
            backdrop-filter: blur(10px); transition: 0.3s;
        }
        .search-bar:focus { outline: none; border-color: var(--neon-cyan); box-shadow: 0 0 20px rgba(0, 243, 255, 0.2); }

        .guide-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; }
        
        .guide-card {
            background: rgba(20, 20, 30, 0.6);
            border: 1px solid var(--glass-border); border-radius: 16px;
            padding: 30px; position: relative; overflow: hidden; transition: all 0.4s ease;
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
        }
        .guide-card:hover { transform: translateY(-5px); border-color: var(--neon-cyan); box-shadow: 0 10px 40px rgba(0, 243, 255, 0.15); }
        
        .guide-card.risk:hover { border-color: var(--neon-pink); box-shadow: 0 10px 40px rgba(255, 0, 85, 0.15); }

        .card-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .guide-icon { font-size: 2rem; }
        .guide-title h3 { font-family: 'Orbitron'; font-size: 1.2rem; color: #fff; margin-bottom: 5px; }
        .guide-title p { color: var(--text-muted); font-size: 0.85rem; }
        
        .expand-btn {
            background: rgba(255,255,255,0.05); border: none; color: var(--neon-cyan);
            width: 100%; padding: 12px; border-radius: 8px; font-family: 'JetBrains Mono'; 
            text-transform: uppercase; cursor: pointer; transition: 0.2s; margin-top: 15px; font-size: 0.8rem;
        }
        .expand-btn:hover { background: rgba(0, 243, 255, 0.1); color: #fff; }

        .details-panel { max-height: 0; overflow: hidden; transition: all 0.5s ease; opacity: 0; }
        .guide-card.expanded .details-panel { max-height: 800px; opacity: 1; margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.05); }
        
        .code-snippet { background: #000; color: var(--neon-pink); padding: 5px 10px; border-radius: 4px; font-family: 'JetBrains Mono'; font-size: 0.8rem; border: 1px solid rgba(255,0,85,0.3); display: inline-block; margin-bottom: 10px; }
        
        /* LEGAL SECTION */
        .legal-wrapper { max-width: 900px; margin: 0 auto; }
        .legal-block { 
            background: rgba(10, 10, 15, 0.8); border: 1px solid var(--glass-border); 
            border-radius: 20px; padding: 40px; margin-bottom: 40px;
            backdrop-filter: blur(20px);
        }
        .legal-block h2 { font-family: 'Orbitron'; color: #fff; border-bottom: 2px solid var(--neon-pink); padding-bottom: 15px; margin-bottom: 30px; font-size: 2rem; }
        .legal-block h3 { color: var(--neon-cyan); font-family: 'Orbitron'; margin: 30px 0 15px; font-size: 1.2rem; }
        .legal-block p, li { color: var(--text-muted); line-height: 1.8; margin-bottom: 15px; font-size: 1rem; }
        .legal-block strong { color: #fff; }

        footer { text-align: center; padding: 50px; color: rgba(255,255,255,0.3); font-size: 0.8rem; font-family: 'JetBrains Mono'; border-top: 1px solid rgba(255,255,255,0.05); position: relative; z-index: 10; background: #050011; }

        @media (max-width: 768px) {
            .hero-title { font-size: 15vw; }
            .guide-grid { grid-template-columns: 1fr; }
            .cta-group { flex-direction: column; width: 100%; }
            .btn-glass { width: 100%; justify-content: center; }
            nav { width: 95%; flex-wrap: wrap; justify-content: center; top: 15px; }
        }
    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <div id="startup-overlay" onclick="initializeSystem()">
        <h1>SYSTEM READY</h1>
        <p>[ TAP TO INITIALIZE PROTOCOL ]</p>
    </div>

    <nav>
        <button id="nav-home" class="nav-btn active" onclick="handleNavClick('home')">Home</button>
        <button id="nav-guide" class="nav-btn" onclick="handleNavClick('guide')">Database</button>
        <button id="nav-legal" class="nav-btn" onclick="handleNavClick('legal')">Legal</button>
        <div id="sound-btn" class="sound-toggle" onclick="toggleSound()">
            <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
        </div>
    </nav>

    <section id="home" class="page-section active">
        <h1 class="hero-title">TRIVIA<br>PROTOCOL</h1>
        <div class="hero-subtitle">Infinite Knowledge Engine</div>
        
        <div class="cta-group">
            <a href="https://discord.gg/ZjJMn8KeZs" target="_blank" class="btn-glass">
                Support Server
            </a>
            <button onclick="handleNavClick('guide')" class="btn-glass secondary">Access Database</button>
        </div>
    </section>

    <section id="guide" class="page-section">
        <div class="docs-container">
            <div class="docs-header">
                <h1>DATA ARCHIVE</h1>
            </div>
            <input type="text" id="guideSearch" class="search-bar" placeholder="SEARCH QUERY..." onkeyup="filterGuide()">

            <div class="guide-grid">
                <div class="guide-card" data-keywords="trivia core start loop">
                    <div class="card-header">
                        <span class="guide-icon">üß†</span>
                        <div class="guide-title">
                            <h3>Core Protocol</h3>
                            <p>Automated Logic</p>
                        </div>
                    </div>
                    <button class="expand-btn" onclick="toggleDetails(this)">‚ñº Access Data</button>
                    <div class="details-panel">
                        <div class="code-snippet">/start [channel]</div>
                        <p style="color:#aaa;">Timer: 20 Minutes ‚Ä¢ Points: 100-500 ‚Ä¢ Global Cooldown: 15m</p>
                    </div>
                </div>

                <div class="guide-card" data-keywords="economy shop items auction">
                    <div class="card-header">
                        <span class="guide-icon">üí≥</span>
                        <div class="guide-title">
                            <h3>Economy</h3>
                            <p>Credits & Trade</p>
                        </div>
                    </div>
                    <button class="expand-btn" onclick="toggleDetails(this)">‚ñº Access Data</button>
                    <div class="details-panel">
                        <div class="code-snippet">/shop</div>
                        <p style="color:#aaa;">Buy Shield, Hint, Backup. Trade rare items on the Marketplace.</p>
                    </div>
                </div>

                <div class="guide-card risk" data-keywords="duel pvp risky">
                    <div class="card-header">
                        <span class="guide-icon">‚öîÔ∏è</span>
                        <div class="guide-title">
                            <h3>Duel Protocol</h3>
                            <p>Risky Mode</p>
                        </div>
                    </div>
                    <button class="expand-btn" onclick="toggleDetails(this)">‚ñº Access Data</button>
                    <div class="details-panel">
                        <div class="code-snippet">/duel [user] Risky</div>
                        <p style="color:#aaa;">Fee: 50 CR. Theft: 30% of loser's wallet on 5-0 win.</p>
                    </div>
                </div>

                <div class="guide-card" data-keywords="raid boss">
                    <div class="card-header">
                        <span class="guide-icon">üëπ</span>
                        <div class="guide-title">
                            <h3>Boss Raids</h3>
                            <p>Co-op Events</p>
                        </div>
                    </div>
                    <button class="expand-btn" onclick="toggleDetails(this)">‚ñº Access Data</button>
                    <div class="details-panel">
                        <div class="code-snippet">/raid_start</div>
                        <p style="color:#aaa;">DMG: 500 per hit. Loot based on DMG dealt.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="legal" class="page-section">
        <div class="legal-wrapper">
            <div id="tos" class="legal-block">
                <h2>Terms of Service</h2>
                <p><strong>Effective Date:</strong> December 2025</p>
                <h3>1. Agreement</h3>
                <p>By using Trivia Bot, you agree to these terms. Misuse results in permanent bans.</p>
                <h3>2. Fair Play</h3>
                <p>Automation, macros, and alt-farming are strictly prohibited.</p>
                <h3>3. Virtual Assets</h3>
                <p>Credits have no real-world monetary value.</p>
            </div>
            
            <div id="privacy" class="legal-block">
                <h2 style="border-color: var(--neon-cyan);">Privacy Policy</h2>
                
                <h3>1. Data Collection</h3>
                <p>We collect User IDs (Inventory), Guild IDs (Config), and Gameplay Statistics.</p>
                
                <h3>2. Seasonal Wipes & Data Retention</h3>
                <p>To ensure fair competition and system health, we enforce <strong>Seasonal Resets</strong>. The data handling policy during a reset is as follows:</p>
                <ul>
                    <li><strong>Deleted Data (The Wipe):</strong> All <strong>Economy Data</strong> is permanently deleted. This includes Credits, Inventory Items, Badges, Duel Records, Market Listings, and Active Auctions.</li>
                    <li><strong>Retained Data (Security):</strong> Your <strong>User ID</strong> and <strong>Ban History</strong> are strictly retained. This ensures that users banned for exploiting cannot return after a season reset.</li>
                    <li><strong>Reset Values:</strong> User profiles are not deleted but reset to default values (Credits: 100, Streaks: 0).</li>
                </ul>
                
                <h3>3. Rights</h3>
                <p>You may request a full account deletion via our Support Server, effectively removing your ID from our database.</p>
            </div>
        </div>
    </section>

    <footer>
        <p>&copy; 2025 TRIVIA PROTOCOL. SYSTEM BY <span style="color:var(--neon-pink)">LLMA</span>.</p>
    </footer>

    <script>
        // --- 1. PROCEDURAL AUDIO ENGINE (LOOP PROOF) ---
        class SynthEngine {
            constructor() {
                this.ctx = null;
                this.masterGain = null;
                this.oscillators = [];
            }
            
            init() {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
                this.masterGain = this.ctx.createGain();
                this.masterGain.connect(this.ctx.destination);
                this.masterGain.gain.value = 0;

                // --- LAYER 1: THE WARM PAD (Chords) ---
                // FMaj7 chord (F, A, C, E) spread out
                const freqs = [87.31, 110.00, 130.81, 164.81]; 
                
                freqs.forEach((f, i) => {
                    const osc = this.ctx.createOscillator();
                    osc.type = "sawtooth";
                    osc.frequency.value = f;
                    
                    // Detune for analog warmth
                    osc.detune.value = (Math.random() - 0.5) * 10; 

                    // Lowpass Filter (The muffled underwater sound)
                    const filter = this.ctx.createBiquadFilter();
                    filter.type = "lowpass";
                    filter.frequency.value = 300; 
                    filter.Q.value = 1;

                    // LFO for filter movement (Breathing)
                    const lfo = this.ctx.createOscillator();
                    lfo.type = "sine";
                    lfo.frequency.value = 0.05 + (Math.random() * 0.05); // Very slow
                    const lfoGain = this.ctx.createGain();
                    lfoGain.gain.value = 100; // Modulate filter by 100Hz
                    
                    lfo.connect(lfoGain);
                    lfoGain.connect(filter.frequency);
                    lfo.start();

                    const oscGain = this.ctx.createGain();
                    oscGain.gain.value = 0.08; // Mix level

                    osc.connect(filter);
                    filter.connect(oscGain);
                    oscGain.connect(this.masterGain);
                    osc.start();
                    this.oscillators.push(osc);
                });

                // --- LAYER 2: PINK NOISE (The "Waves") ---
                const bufferSize = 2 * this.ctx.sampleRate;
                const noiseBuffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
                const output = noiseBuffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) {
                    const white = Math.random() * 2 - 1;
                    output[i] = (lastOut + (0.02 * white)) / 1.02;
                    lastOut = output[i];
                    output[i] *= 3.5; 
                }
                var lastOut = 0;

                const noise = this.ctx.createBufferSource();
                noise.buffer = noiseBuffer;
                noise.loop = true;
                
                const noiseFilter = this.ctx.createBiquadFilter();
                noiseFilter.type = "bandpass";
                noiseFilter.frequency.value = 600; 
                
                // LFO for Waves
                const waveLfo = this.ctx.createOscillator();
                waveLfo.type = "sine";
                waveLfo.frequency.value = 0.15; // Speed of waves
                const waveGain = this.ctx.createGain();
                waveGain.gain.value = 0.02; // Volume of waves
                
                // VCA (Voltage Controlled Amplifier) approach for volume swelling
                const volumeLfo = this.ctx.createGain();
                volumeLfo.gain.value = 0; 
                waveLfo.connect(volumeLfo.gain);
                
                noise.connect(noiseFilter);
                noiseFilter.connect(volumeLfo);
                volumeLfo.connect(this.masterGain);
                
                noise.start();
                waveLfo.start();
            }

            fadeIn() { if(this.ctx) this.masterGain.gain.setTargetAtTime(0.5, this.ctx.currentTime, 3); }
            fadeOut() { if(this.ctx) this.masterGain.gain.setTargetAtTime(0, this.ctx.currentTime, 0.5); }
        }

        const audio = new SynthEngine();
        let soundOn = false;

        function initializeSystem() {
            document.getElementById('startup-overlay').style.opacity = '0';
            setTimeout(() => document.getElementById('startup-overlay').remove(), 1000);
            toggleSound();
        }

        function toggleSound() {
            const btn = document.getElementById('sound-btn');
            if(!soundOn) {
                if(!audio.ctx) audio.init();
                audio.ctx.resume().then(() => {
                    audio.fadeIn();
                    soundOn = true;
                    btn.classList.add('active');
                });
            } else {
                audio.fadeOut();
                soundOn = false;
                btn.classList.remove('active');
            }
        }

        // --- 2. THREE.JS WAVE SCENE ---
        const init3D = () => {
            const container = document.getElementById('canvas-container');
            const scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x050011, 0.002); // Deep purple fog

            const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
            camera.position.set(0, 30, 100); 

            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            // --- A. THE RETRO SUN ---
            const sunCanvas = document.createElement('canvas');
            sunCanvas.width = 128; sunCanvas.height = 128;
            const ctx = sunCanvas.getContext('2d');
            const grad = ctx.createLinearGradient(0, 0, 0, 128);
            grad.addColorStop(0, '#ffd700'); 
            grad.addColorStop(1, '#ff4800');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, 128, 128);
            // Scanlines
            ctx.fillStyle = '#050011';
            for(let y=64; y<128; y+=8) ctx.fillRect(0, y, 128, 2 + (y-64)/10);
            
            const sunTex = new THREE.CanvasTexture(sunCanvas);
            const sunMat = new THREE.MeshBasicMaterial({ map: sunTex, transparent: true, fog: false });
            const sun = new THREE.Mesh(new THREE.PlaneGeometry(300, 300), sunMat);
            sun.position.set(0, 80, -500);
            scene.add(sun);

            // Reflection on water
            const refSun = sun.clone();
            refSun.scale.y = -1;
            refSun.position.y = -80;
            refSun.material = sunMat.clone();
            refSun.material.opacity = 0.2;
            scene.add(refSun);

            // --- B. THE LIQUID GRID (WAVES) ---
            const planeGeo = new THREE.PlaneGeometry(1000, 1000, 60, 60);
            const planeMat = new THREE.MeshBasicMaterial({ 
                color: 0x00f3ff, 
                wireframe: true,
                transparent: true, 
                opacity: 0.25
            });
            const water = new THREE.Mesh(planeGeo, planeMat);
            water.rotation.x = -Math.PI / 2;
            scene.add(water);

            // Duplicate for infinite scroll
            const water2 = water.clone();
            water2.position.z = -1000;
            scene.add(water2);

            // --- C. MOUNTAINS (WIREFRAME) ---
            const mtnGeo = new THREE.ConeGeometry(80, 200, 4, 1, true);
            const mtnMat = new THREE.MeshBasicMaterial({ color: 0xff0055, wireframe: true, transparent:true, opacity: 0.2 });
            
            // Left Mountains
            for(let i=0; i<5; i++) {
                const m = new THREE.Mesh(mtnGeo, mtnMat);
                m.position.set(-200 - (Math.random()*100), 0, -i*200);
                scene.add(m);
            }
            // Right Mountains
            for(let i=0; i<5; i++) {
                const m = new THREE.Mesh(mtnGeo, mtnMat);
                m.position.set(200 + (Math.random()*100), 0, -i*200);
                scene.add(m);
            }

            // --- ANIMATION LOOP ---
            const simplex = new SimplexNoise();
            let time = 0;

            const animate = () => {
                requestAnimationFrame(animate);
                time += 0.005;

                // 1. Move Grid (Infinite Scroll)
                water.position.z += 1.5;
                water2.position.z += 1.5;
                if(water.position.z > 500) water.position.z = -1500;
                if(water2.position.z > 500) water2.position.z = -1500;

                // 2. Animate Waves (Vertex Displacement)
                updateWaves(water, time);
                updateWaves(water2, time);

                // 3. Camera subtle float
                camera.position.y = 30 + Math.sin(time)*2;

                renderer.render(scene, camera);
            };

            function updateWaves(mesh, t) {
                const pos = mesh.geometry.attributes.position;
                for (let i = 0; i < pos.count; i++) {
                    const x = pos.getX(i);
                    const y = pos.getY(i); // This is Z in world space
                    // Create wave effect
                    const z = Math.sin(x * 0.05 + t) * 5 + Math.sin(y * 0.05 + t) * 5;
                    pos.setZ(i, z);
                }
                pos.needsUpdate = true;
            }

            animate();

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        };

        // --- 3. UI LOGIC ---
        function handleNavClick(targetId) {
            document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(targetId).classList.add('active');
            document.getElementById('nav-'+targetId).classList.add('active');
            window.scrollTo(0,0);
        }

        function toggleDetails(btn) {
            const card = btn.parentElement;
            const was = card.classList.contains('expanded');
            document.querySelectorAll('.guide-card').forEach(c => {
                c.classList.remove('expanded');
                c.querySelector('.expand-btn').innerText = '‚ñº Access Data';
            });
            if(!was) {
                card.classList.add('expanded');
                btn.innerText = '‚ñ≤ Close Data';
            }
        }

        function filterGuide() {
            const val = document.getElementById('guideSearch').value.toLowerCase();
            document.querySelectorAll('.guide-card').forEach(c => {
                c.style.display = (c.innerText.toLowerCase().includes(val) || c.dataset.keywords.includes(val)) ? 'block' : 'none';
            });
        }

        window.addEventListener('load', () => {
            init3D();
            const hash = window.location.hash.substring(1);
            if(hash) {
                document.getElementById('startup-overlay').remove();
                if(hash === 'tos' || hash === 'privacy') handleNavClick('legal');
                else handleNavClick(hash === 'guide' ? 'guide' : 'home');
            }
        });
    </script>
</body>
</html>
